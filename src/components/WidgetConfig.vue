<template>
    <div 
        class="form-config-container"
        v-if="show"
    >
        <el-form label-position="top">
            <el-form-item label="标题" v-if="data.type!='grid'">
                <el-input v-model="data.name"></el-input>
            </el-form-item>
            <el-form-item label="宽度" v-if="Object.keys(data.options).indexOf('width')>=0">
                <el-input v-model="data.options.width"></el-input>
            </el-form-item>
            <el-form-item label="占位内容" v-if="Object.keys(data.options).indexOf('placeholder')>=0 && (data.type!='time' || data.type!='date')">
                <el-input v-model="data.options.placeholder"></el-input>
            </el-form-item>
            <el-form-item label="显示输入框" v-if="Object.keys(data.options).indexOf('showInput')>=0">
                <el-switch v-model="data.options.showInput"></el-switch>
            </el-form-item>
            <el-form-item label="最小值" v-if="Object.keys(data.options).indexOf('min')>=0">
                <el-input-number v-model="data.options.min" :min="0" :max="100" :step="1"></el-input-number>
            </el-form-item>
            <el-form-item label="最大值" v-if="Object.keys(data.options).indexOf('max')>=0">
                <el-input-number v-model="data.options.max" :min="0" :max="100" :step="1"></el-input-number>
            </el-form-item>
            <el-form-item label="步长" v-if="Object.keys(data.options).indexOf('step')>=0">
                <el-input-number v-model="data.options.step" :min="0" :max="100" :step="1"></el-input-number>
            </el-form-item>

            <template v-if="data.type=='radio' || (data.type=='select'&&!data.options.multiple)">
                <el-radio-group v-model="data.options.defaultValue">
                    <draggable tag="ul" :list="data.options.options" 
                        v-bind="{group:{ name:'options'}, ghostClass: 'ghost',handle: '.drag-item'}"
                        handle=".drag-item">
                        <li v-for="(item, index) in data.options.options" :key="index" >
                            <el-radio
                                :label="item.value" 
                                style="margin-right: 5px;">
                                <el-input 
                                    :style="{'width': data.options.showLabel? '90px': '180px' }" 
                                    size="mini" 
                                    v-model="item.value"></el-input>
                                <el-input 
                                    style="width:90px;" 
                                    size="mini" 
                                    v-if="data.options.showLabel" 
                                    v-model="item.label"></el-input>
                            </el-radio>
                            <i class="drag-item" 
                                style="font-size: 16px;margin: 0 5px;cursor: move;"><i class="iconfont icon-icon_bars"></i></i>
                            <el-button @click="handleOptionsRemove(index)" 
                                circle plain type="danger" 
                                size="mini" 
                                icon="el-icon-minus" 
                                style="padding: 4px;margin-left: 5px;"></el-button>
                        </li>
                    </draggable>
                </el-radio-group>

                <div style="margin-left: 22px;">
                    <el-button type="text" @click="handleAddOption">添加选项</el-button>
                </div>
            </template>

            <template v-if="data.type=='text'">
                <el-form-item label="文字信息">
                    <el-input v-model="data.options.defaultValue"></el-input>
                </el-form-item>
            </template>

            <template v-if="data.type=='checkbox' || (data.type=='select' && data.options.multiple)">
                <el-checkbox-group v-model="data.options.defaultValue">
                    <draggable tag="ul" :list="data.options.options" 
                        v-bind="{group:{ name:'options'}, ghostClass: 'ghost',handle: '.drag-item'}"
                        handle=".drag-item">
                        <li v-for="(item, index) in data.options.options" :key="index" >
                            <el-checkbox
                                :label="item.value"
                                style="margin-right: 5px;">
                                <el-input 
                                    :style="{'width': data.options.showLabel? '90px': '180px' }" 
                                    size="mini" 
                                    v-model="item.value"></el-input>
                                <el-input 
                                    style="width:90px;"    
                                    size="mini" 
                                    v-if="data.options.showLabel" 
                                    v-model="item.label"></el-input>
                            </el-checkbox>
                            <i class="drag-item" style="font-size: 16px;margin: 0 5px;cursor: move;"><i class="iconfont icon-icon_bars"></i></i>
                            <el-button 
                                @click="handleOptionsRemove(index)" 
                                circle plain type="danger" 
                                size="mini" 
                                icon="el-icon-minus" 
                                style="padding: 4px;margin-left: 5px;"></el-button>
                        </li>
                    </draggable>
                </el-checkbox-group>

                <div style="margin-left: 22px;">
                    <el-button type="text" @click="handleAddOption">添加选项</el-button>
                </div>
            </template>
            
            <el-form-item label="默认值" 
                v-if="Object.keys(data.options).indexOf('defaultValue')>=0 && (data.type == 'textarea' || data.type == 'input' || data.type=='rate' || data.type=='switch')">
                <el-input v-if="data.type=='textarea'" type="textarea" :rows="5" v-model="data.options.defaultValue"></el-input>
                <el-input v-if="data.type=='input'" v-model="data.options.defaultValue"></el-input>
                <el-rate v-if="data.type == 'rate'" 
                    style="display:inline-block;vertical-align: middle;" 
                    :max="data.options.max" 
                    :allow-half="data.options.allowHalf" 
                    v-model="data.options.defaultValue"></el-rate>
                <el-button type="text" 
                    v-if="data.type == 'rate'" 
                    style="display:inline-block;vertical-align: middle;margin-left: 10px;" 
                    @click="data.options.defaultValue=0">清空</el-button>
                <el-switch v-if="data.type=='switch'" v-model="data.options.defaultValue"></el-switch>
            </el-form-item>

            <template v-if="data.type == 'time' || data.type == 'date'">
                <el-form-item v-if="data.type == 'date'" label="显示类型">
                    <el-select v-model="data.options.type">
                        <el-option value="year"></el-option>
                        <el-option value="month"></el-option>
                        <el-option value="date"></el-option>
                        <el-option value="dates"></el-option>
                        <!-- <el-option value="week"></el-option> -->
                        <el-option value="datetime"></el-option>
                        <el-option value="datetimerange"></el-option>
                        <el-option value="daterange"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="是否为范围选择" v-if="data.type == 'time'">
                    <el-switch v-model="data.options.isRange"></el-switch>
                </el-form-item>
                <el-form-item label="是否获取时间戳" v-if="data.type == 'date'">
                    <el-switch v-model="data.options.timestamp"></el-switch>
                </el-form-item>
                <el-form-item label="开始时间占位内容"
                    v-if="(data.options.isRange) || data.options.type=='datetimerange' || data.options.type=='daterange'"
                >
                    <el-input v-model="data.options.startPlaceholder"></el-input>
                </el-form-item>
                <el-form-item label="结束时间占位内容"
                     v-if="(data.options.isRange) || data.options.type=='datetimerange' || data.options.type=='daterange'"
                >
                    <el-input v-model="data.options.endPlaceholder"></el-input>
                </el-form-item>
                <el-form-item label="格式">
                    <el-input v-model="data.options.format"></el-input>
                </el-form-item>

                <!-- 这里有点问题，time和input合用的时候 -->
                <el-form-item label="默认值"
                    v-if="data.type=='time' && Object.keys(data.options).indexOf('isRange')>=0">
                    <el-time-picker
                        key="1"
                        style="width: 100%"
                        v-if="!data.options.isRange"
                        v-model="data.options.defaultValue"
                        :arrowControl="data.options.arrowControl"
                        :value-format="data.options.format"
                    ></el-time-picker>
                    <el-time-picker
                        key="2"
                        v-if="data.options.isRange"
                        style="width: 100%"
                        v-model="data.options.defaultValue"
                        is-range
                        :arrowControl="data.options.arrowControl"
                        :value-format="data.options.format"
                    ></el-time-picker>
                </el-form-item>
            </template>

            <template v-if="data.type == 'grid'">
                <el-form-item label="栅格间隔">
                    <el-input type="number" v-model.number="data.options.gutter"></el-input>
                </el-form-item>
                <el-form-item label="列配置项">
                    <draggable tag="ul" :list="data.columns" 
                        v-bind="{group:{ name:'options'}, ghostClass: 'ghost',handle: '.drag-item'}"
                        handle=".drag-item"
                    >
                        <li v-for="(item, index) in data.columns" :key="index" >
                            <i class="drag-item" style="font-size: 16px;margin: 0 5px;cursor: move;"><i class="iconfont icon-icon_bars"></i></i>
                            <el-input placeholder="栅格值" size="mini" style="width: 100px;" type="number" v-model.number="item.span"></el-input>
              
                            <el-button @click="handleOptionsRemove(index)" circle plain type="danger" size="mini" icon="el-icon-minus" style="padding: 4px;margin-left: 5px;"></el-button>
              
                        </li>
                    </draggable>
                    <div style="margin-left: 22px;">
                        <el-button type="text" @click="handleAddColumn">添加列</el-button>
                    </div>
                </el-form-item>
            </template>

            <template v-if="data.type != 'grid'">
                <!-- <el-form-item label="数据绑定key">
                    <el-input v-model="data.model"></el-input>
                </el-form-item> -->
                <el-form-item label="操作属性">
                    <el-checkbox v-model="data.options.readonly"
                        v-if="Object.keys(data.options).indexOf('readonly')>=0">完全只读</el-checkbox>
                    <el-checkbox v-model="data.options.disabled"
                        v-if="Object.keys(data.options).indexOf('disabled')>=0">禁用</el-checkbox>
                    <el-checkbox v-model="data.options.editable" 
                        v-if="Object.keys(data.options).indexOf('editable')>=0">文本框可输入</el-checkbox>
                    <el-checkbox v-model="data.options.clearable" 
                        v-if="Object.keys(data.options).indexOf('clearable')>=0">显示清除按钮</el-checkbox>
                    <el-checkbox v-model="data.options.arrowControl" 
                        v-if="Object.keys(data.options).indexOf('arrowControl')>=0">使用箭头进行时间选择</el-checkbox>
                    <el-checkbox v-model="data.options.isDelete" 
                        v-if="Object.keys(data.options).indexOf('isDelete')>=0">删除</el-checkbox>
                    <el-checkbox v-model="data.options.isEdit" 
                        v-if="Object.keys(data.options).indexOf('isEdit')>=0">编辑</el-checkbox>
                </el-form-item>

                <el-form-item></el-form-item>
                
            </template>
        </el-form>
    </div>
</template>

<script>
export default {
    props: ['data'],
    computed: {
        show () {
            if (this.data && Object.keys(this.data).length > 0) {
                return true
            }
            return false
        }
    },
    methods: {
        handleOptionsRemove (index) {
            if(this.data.type === 'grid') {
                this.data.columns.splice(index, 1)
            } else {
                this.data.options.options.splice(index, 1)
            }
        },
        handleAddOption () {
            if (this.data.options.showLabel) {
                this.data.options.options.push({
                    value: '新选项',
                    label: '新选项'
                })
            } else {
                this.data.options.options.push({
                    value: '新选项'
                })
            }
        },
        handleAddColumn () {
            this.data.columns.push({
            span: '',
            list: []
            })
        },
    },
    watch: {
        'data.options.isRange': function(val) {
            if (typeof val !== 'undefined') {
                if (val) {
                    this.data.options.defaultValue = null
                } else {
                    if (Object.keys(this.data.options).indexOf('defaultValue')>=0){
                        this.data.options.defaultValue = ''
                    }
                }
            }
        }
    }
}
</script>

